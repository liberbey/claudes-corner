<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="ad.size" content="width=320,height=480">
<title>3 Keys, 9 Boxes</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

  body {
    font-family: -apple-system, 'Segoe UI', Roboto, sans-serif;
    background: #0a0a1a;
    color: #fff;
    overflow: hidden;
    width: 100vw;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    user-select: none;
    -webkit-user-select: none;
  }

  #game {
    width: 100%;
    max-width: 400px;
    padding: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }

  .header {
    text-align: center;
    width: 100%;
  }

  .header h1 {
    font-size: 22px;
    font-weight: 800;
    background: linear-gradient(135deg, #ffd700, #ff8c00);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: -0.5px;
  }

  .stats {
    display: flex;
    justify-content: center;
    gap: 24px;
    width: 100%;
    padding: 8px 0;
  }

  .stat {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 18px;
    font-weight: 700;
  }

  .stat-icon {
    width: 28px;
    height: 28px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
  }

  .stat-icon.key { background: linear-gradient(135deg, #ffd700, #f0a500); }
  .stat-icon.prize { background: linear-gradient(135deg, #00c853, #00e676); }

  .stat-value {
    font-variant-numeric: tabular-nums;
    min-width: 20px;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    width: 100%;
    max-width: 300px;
    padding: 4px;
  }

  .box {
    aspect-ratio: 1;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    position: relative;
    transition: transform 0.15s ease;
    background: linear-gradient(145deg, #2a2a4a, #1a1a3a);
    border: 2px solid #3a3a6a;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.08);
    overflow: hidden;
  }

  .box::before {
    content: '?';
    font-size: 32px;
    font-weight: 800;
    color: #6a6a9a;
    transition: opacity 0.2s;
  }

  .box:active:not(.opened):not(.locked) {
    transform: scale(0.93);
  }

  .box.pulse {
    animation: boxPulse 1.5s ease-in-out infinite;
  }

  @keyframes boxPulse {
    0%, 100% { border-color: #3a3a6a; box-shadow: 0 4px 12px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.08); }
    50% { border-color: #ffd700; box-shadow: 0 4px 20px rgba(255,215,0,0.25), inset 0 1px 0 rgba(255,255,255,0.08); }
  }

  .box.opened {
    cursor: default;
    transform: none;
  }

  .box.opened::before {
    opacity: 0;
  }

  .box.locked {
    cursor: default;
    opacity: 0.35;
  }

  .box.locked::before {
    content: 'ðŸ”’';
    font-size: 24px;
  }

  .box-content {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transform: scale(0.5) rotateY(90deg);
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  .box.opened .box-content {
    opacity: 1;
    transform: scale(1) rotateY(0deg);
  }

  .box-content .icon {
    font-size: 36px;
    line-height: 1;
  }

  .box-content .label {
    font-size: 11px;
    font-weight: 700;
    margin-top: 2px;
    letter-spacing: 0.5px;
  }

  /* Box types */
  .box.type-prize {
    background: linear-gradient(145deg, #1a3a1a, #0a2a0a);
    border-color: #00c853;
    box-shadow: 0 4px 20px rgba(0,200,83,0.3);
  }
  .box.type-prize .label { color: #00e676; }

  .box.type-key {
    background: linear-gradient(145deg, #3a3a1a, #2a2a0a);
    border-color: #ffd700;
    box-shadow: 0 4px 20px rgba(255,215,0,0.3);
  }
  .box.type-key .label { color: #ffd700; }

  .box.type-empty {
    background: linear-gradient(145deg, #1a1a1a, #0a0a0a);
    border-color: #444;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
  }
  .box.type-empty .label { color: #666; }

  /* Shake animation */
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-6px) rotate(-2deg); }
    40% { transform: translateX(6px) rotate(2deg); }
    60% { transform: translateX(-4px) rotate(-1deg); }
    80% { transform: translateX(4px) rotate(1deg); }
  }
  .shake { animation: shake 0.5s ease; }

  /* Prize burst */
  @keyframes burst {
    0% { transform: scale(0.5); opacity: 0; }
    50% { transform: scale(1.3); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
  }
  .burst .box-content { animation: burst 0.5s ease-out; transform: scale(1) rotateY(0deg); opacity: 1; }

  /* Float up text */
  .float-text {
    position: absolute;
    font-size: 20px;
    font-weight: 800;
    pointer-events: none;
    animation: floatUp 1.2s ease-out forwards;
    z-index: 100;
    text-shadow: 0 2px 8px rgba(0,0,0,0.6);
  }
  @keyframes floatUp {
    0% { opacity: 1; transform: translateY(0) scale(1); }
    100% { opacity: 0; transform: translateY(-60px) scale(1.3); }
  }

  /* Hint text */
  .hint {
    font-size: 14px;
    color: #8888aa;
    text-align: center;
    min-height: 20px;
    transition: opacity 0.3s;
  }

  /* CTA overlay */
  #cta {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 200;
    pointer-events: none;
    opacity: 0;
    transition: background 0.6s, opacity 0.6s;
    gap: 20px;
    padding: 30px;
  }

  #cta.visible {
    background: rgba(0,0,0,0.85);
    pointer-events: all;
    opacity: 1;
  }

  #cta h2 {
    font-size: 26px;
    font-weight: 800;
    text-align: center;
    line-height: 1.3;
  }

  #cta .remaining {
    display: flex;
    gap: 8px;
    justify-content: center;
    flex-wrap: wrap;
  }

  #cta .remaining .mini-box {
    width: 44px;
    height: 44px;
    border-radius: 10px;
    background: linear-gradient(145deg, #2a2a4a, #1a1a3a);
    border: 2px solid #3a3a6a;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    font-weight: 800;
    color: #6a6a9a;
    animation: ctaPulse 2s ease-in-out infinite;
  }

  @keyframes ctaPulse {
    0%, 100% { border-color: #3a3a6a; }
    50% { border-color: #ffd700; box-shadow: 0 0 12px rgba(255,215,0,0.3); }
  }

  #cta .remaining .mini-box:nth-child(2) { animation-delay: 0.3s; }
  #cta .remaining .mini-box:nth-child(3) { animation-delay: 0.6s; }
  #cta .remaining .mini-box:nth-child(4) { animation-delay: 0.9s; }

  .cta-btn {
    background: linear-gradient(135deg, #ffd700, #ff8c00);
    color: #000;
    border: none;
    border-radius: 50px;
    padding: 16px 40px;
    font-size: 20px;
    font-weight: 800;
    cursor: pointer;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 20px rgba(255,140,0,0.4);
    transition: transform 0.15s;
    animation: ctaBtnPulse 2s ease-in-out infinite;
  }

  .cta-btn:active {
    transform: scale(0.95);
  }

  @keyframes ctaBtnPulse {
    0%, 100% { box-shadow: 0 4px 20px rgba(255,140,0,0.4); }
    50% { box-shadow: 0 4px 30px rgba(255,140,0,0.7); transform: scale(1.03); }
  }

  #cta .subtext {
    font-size: 13px;
    color: #888;
  }

  /* Particles */
  .particle {
    position: fixed;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    pointer-events: none;
    z-index: 50;
  }

  @keyframes particleFly {
    0% { opacity: 1; transform: translate(0, 0) scale(1); }
    100% { opacity: 0; transform: translate(var(--dx), var(--dy)) scale(0); }
  }

  /* Intro */
  #intro {
    position: fixed;
    inset: 0;
    background: #0a0a1a;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 300;
    gap: 24px;
    padding: 30px;
    transition: opacity 0.5s;
  }

  #intro.hidden {
    opacity: 0;
    pointer-events: none;
  }

  #intro h1 {
    font-size: 32px;
    font-weight: 900;
    background: linear-gradient(135deg, #ffd700, #ff8c00);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-align: center;
  }

  #intro .rules {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 280px;
  }

  #intro .rule {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 16px;
    color: #ccc;
  }

  #intro .rule-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    flex-shrink: 0;
  }

  .play-btn {
    background: linear-gradient(135deg, #ffd700, #ff8c00);
    color: #000;
    border: none;
    border-radius: 50px;
    padding: 18px 50px;
    font-size: 22px;
    font-weight: 800;
    cursor: pointer;
    letter-spacing: 1px;
    box-shadow: 0 4px 20px rgba(255,140,0,0.4);
    transition: transform 0.15s;
    margin-top: 8px;
    animation: ctaBtnPulse 2s ease-in-out infinite;
  }

  .play-btn:active { transform: scale(0.95); }

  /* Responsive */
  @media (max-height: 500px) {
    .header h1 { font-size: 18px; }
    .stat { font-size: 15px; }
    .grid { gap: 6px; max-width: 250px; }
    .box-content .icon { font-size: 28px; }
  }
</style>
</head>
<body>

<!-- Intro Screen -->
<div id="intro">
  <h1>THE HEIST</h1>
  <div class="rules">
    <div class="rule">
      <div class="rule-icon" style="background:linear-gradient(135deg,#ffd700,#f0a500);">ðŸ”‘</div>
      <span>You have <b>3 keys</b></span>
    </div>
    <div class="rule">
      <div class="rule-icon" style="background:linear-gradient(135deg,#2a2a4a,#1a1a3a);">ðŸ“¦</div>
      <span>There are <b>9 boxes</b></span>
    </div>
    <div class="rule">
      <div class="rule-icon" style="background:linear-gradient(135deg,#00c853,#00e676);">ðŸ’Ž</div>
      <span>Find all <b>3 prizes</b> to win</span>
    </div>
    <div class="rule">
      <div class="rule-icon" style="background:linear-gradient(135deg,#ff4444,#cc0000);">âš¡</div>
      <span>Some boxes give <b>extra keys</b></span>
    </div>
  </div>
  <button class="play-btn" onclick="startGame()">TAP TO PLAY</button>
</div>

<!-- Game -->
<div id="game" style="display:none;">
  <div class="header">
    <h1>THE HEIST</h1>
  </div>

  <div class="stats">
    <div class="stat">
      <div class="stat-icon key">ðŸ”‘</div>
      <span class="stat-value" id="keyCount">3</span>
    </div>
    <div class="stat">
      <div class="stat-icon prize">ðŸ’Ž</div>
      <span class="stat-value" id="prizeCount">0/3</span>
    </div>
  </div>

  <div class="grid" id="grid"></div>

  <div class="hint" id="hint">Tap a box to open it</div>
</div>

<!-- CTA Overlay -->
<div id="cta">
  <h2 id="ctaTitle">4 boxes left...</h2>
  <div class="remaining" id="ctaBoxes"></div>
  <button class="cta-btn" onclick="clickCTA()">OPEN THEM ALL</button>
  <div class="subtext">Free to play</div>
</div>

<script>
// =====================================================
// PLAYABLE AD: 3 Keys, 9 Boxes
// Scripted sequence designed for maximum engagement.
// Based on the box game heist mechanic.
// =====================================================

// Scripted sequence â€” designed for the best ad experience:
// K2 (hope: +2 keys = 4 total), P2 (dopamine: first prize!),
// B (tension: empty), P1 (relief: second prize!),
// B (last key tension)... then CTA with 4 boxes left
const SCRIPTED_SEQUENCE = [
  { type: 'key',   label: 'K2', icon: 'ðŸ”‘', value: 2, text: '+2 KEYS!' },
  { type: 'prize', label: 'P2', icon: 'ðŸ’Ž', value: 2, text: 'PRIZE!' },
  { type: 'empty', label: 'B',  icon: 'ðŸ’¨', value: 0, text: 'EMPTY' },
  { type: 'prize', label: 'P1', icon: 'ðŸ’Ž', value: 1, text: 'PRIZE!' },
  { type: 'empty', label: 'B',  icon: 'ðŸ’¨', value: 0, text: 'EMPTY' },
  // These are never revealed â€” they're behind the CTA
  { type: 'key',   label: 'K3', icon: 'ðŸ”‘', value: 3, text: '+3 KEYS!' },
  { type: 'prize', label: 'P4', icon: 'ðŸ’Ž', value: 4, text: 'BIG PRIZE!' },
  { type: 'key',   label: 'K1', icon: 'ðŸ”‘', value: 1, text: '+1 KEY!' },
  { type: 'empty', label: 'B',  icon: 'ðŸ’¨', value: 0, text: 'EMPTY' },
];

let keys = 3;
let prizeValue = 0;
let prizeBoxes = 0;  // count of prize BOXES found (max 3)
let openedCount = 0;
let gameActive = false;
let boxElements = [];

function startGame() {
  document.getElementById('intro').classList.add('hidden');
  document.getElementById('game').style.display = 'flex';

  setTimeout(() => {
    gameActive = true;
    buildGrid();
  }, 300);
}

function buildGrid() {
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  boxElements = [];

  // Shuffle visual positions (the CONTENT is scripted, but box positions are shuffled)
  // We create 9 boxes in random positions but reveal in tap order from the script
  for (let i = 0; i < 9; i++) {
    const box = document.createElement('div');
    box.className = 'box';
    box.dataset.index = i;

    const content = document.createElement('div');
    content.className = 'box-content';
    box.appendChild(content);

    box.addEventListener('click', () => openBox(i));
    box.addEventListener('touchstart', (e) => e.preventDefault(), { passive: false });

    grid.appendChild(box);
    boxElements.push(box);
  }

  // Make unopened boxes pulse to invite interaction
  setTimeout(() => {
    boxElements.forEach(b => {
      if (!b.classList.contains('opened')) b.classList.add('pulse');
    });
  }, 500);
}

function openBox(index) {
  if (!gameActive) return;

  const box = boxElements[index];
  if (box.classList.contains('opened') || box.classList.contains('locked')) return;
  if (keys <= 0) return;

  // Spend a key
  keys--;

  // Get scripted content for this reveal
  const content = SCRIPTED_SEQUENCE[openedCount];
  openedCount++;

  // Remove pulse from this box
  box.classList.remove('pulse');

  // Update box appearance
  box.classList.add('opened', `type-${content.type}`);

  const contentEl = box.querySelector('.box-content');
  contentEl.innerHTML = `
    <span class="icon">${content.icon}</span>
    <span class="label">${content.label}</span>
  `;

  // Apply effects
  if (content.type === 'key') {
    keys += content.value;
    box.classList.add('burst');
    spawnParticles(box, '#ffd700', 8);
    showFloatText(box, content.text, '#ffd700');
  } else if (content.type === 'prize') {
    prizeValue += content.value;
    prizeBoxes++;
    box.classList.add('burst');
    spawnParticles(box, '#00e676', 12);
    showFloatText(box, content.text, '#00e676');
  } else {
    box.classList.add('shake');
    showFloatText(box, content.text, '#666');
  }

  // Update display
  updateStats();
  updateHint(content);

  // Check if we should show CTA (after 5 boxes opened = 0 keys with scripted sequence)
  if (openedCount >= 5) {
    gameActive = false;
    setTimeout(showCTA, 800);
  }
}

function updateStats() {
  const keyEl = document.getElementById('keyCount');
  const prizeEl = document.getElementById('prizeCount');

  keyEl.textContent = keys;
  prizeEl.textContent = prizeBoxes + '/3';

  // Animate the stat change
  keyEl.style.transform = 'scale(1.4)';
  prizeEl.style.transform = 'scale(1.4)';
  setTimeout(() => {
    keyEl.style.transition = 'transform 0.3s';
    prizeEl.style.transition = 'transform 0.3s';
    keyEl.style.transform = 'scale(1)';
    prizeEl.style.transform = 'scale(1)';
  }, 100);
}

function updateHint(content) {
  const hint = document.getElementById('hint');
  if (content.type === 'key') {
    hint.textContent = `Nice! ${keys} keys now â€” keep going!`;
    hint.style.color = '#ffd700';
  } else if (content.type === 'prize') {
    hint.textContent = prizeBoxes >= 2 ? 'One more prize to find!' : 'Found a prize!';
    hint.style.color = '#00e676';
  } else {
    hint.textContent = keys > 0 ? `${keys} key${keys !== 1 ? 's' : ''} left... choose carefully` : 'Out of keys...';
    hint.style.color = '#ff6666';
  }
}

function showCTA() {
  const cta = document.getElementById('cta');
  const remaining = 9 - openedCount;

  document.getElementById('ctaTitle').innerHTML =
    `<span style="color:#ffd700">${remaining} boxes</span> left to open...<br>Can you find the last prize?`;

  // Show mini boxes for remaining
  const boxesContainer = document.getElementById('ctaBoxes');
  boxesContainer.innerHTML = '';
  for (let i = 0; i < remaining; i++) {
    const mini = document.createElement('div');
    mini.className = 'mini-box';
    mini.textContent = '?';
    boxesContainer.appendChild(mini);
  }

  // Lock remaining boxes in the grid
  boxElements.forEach(b => {
    if (!b.classList.contains('opened')) {
      b.classList.remove('pulse');
      b.classList.add('locked');
    }
  });

  setTimeout(() => cta.classList.add('visible'), 200);
}

function clickCTA() {
  // In a real ad, this opens the app store.
  // For demo, we'll show a brief message then reset.
  const cta = document.getElementById('cta');
  const btn = cta.querySelector('.cta-btn');
  btn.textContent = 'â†’ APP STORE';
  btn.style.background = 'linear-gradient(135deg, #00c853, #00e676)';

  // In production, replace with:
  // window.open('https://apps.apple.com/...') or mraid.open(url)

  setTimeout(() => {
    // Reset for demo loop
    resetGame();
  }, 1500);
}

function resetGame() {
  keys = 3;
  prizeValue = 0;
  prizeBoxes = 0;
  openedCount = 0;
  gameActive = true;

  document.getElementById('cta').classList.remove('visible');
  document.getElementById('keyCount').textContent = '3';
  document.getElementById('prizeCount').textContent = '0/3';
  document.getElementById('hint').textContent = 'Tap a box to open it';
  document.getElementById('hint').style.color = '#8888aa';

  const btn = document.querySelector('.cta-btn');
  btn.textContent = 'OPEN THEM ALL';
  btn.style.background = 'linear-gradient(135deg, #ffd700, #ff8c00)';

  buildGrid();
}

function showFloatText(box, text, color) {
  const rect = box.getBoundingClientRect();
  const el = document.createElement('div');
  el.className = 'float-text';
  el.textContent = text;
  el.style.color = color;
  el.style.left = rect.left + rect.width / 2 - 40 + 'px';
  el.style.top = rect.top - 10 + 'px';
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 1200);
}

function spawnParticles(box, color, count) {
  const rect = box.getBoundingClientRect();
  const cx = rect.left + rect.width / 2;
  const cy = rect.top + rect.height / 2;

  for (let i = 0; i < count; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.style.background = color;
    p.style.left = cx + 'px';
    p.style.top = cy + 'px';

    const angle = (Math.PI * 2 * i) / count + (Math.random() - 0.5) * 0.5;
    const dist = 40 + Math.random() * 60;
    p.style.setProperty('--dx', Math.cos(angle) * dist + 'px');
    p.style.setProperty('--dy', Math.sin(angle) * dist + 'px');
    p.style.animation = `particleFly ${0.6 + Math.random() * 0.4}s ease-out forwards`;

    document.body.appendChild(p);
    setTimeout(() => p.remove(), 1200);
  }
}

// Prevent scrolling/bouncing on mobile
document.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });

// Auto-start after 10 seconds if user hasn't tapped (ad network requirement)
let autoStartTimer = setTimeout(() => {
  if (document.getElementById('intro').style.opacity !== '0') {
    startGame();
  }
}, 10000);

document.getElementById('intro').addEventListener('click', () => {
  clearTimeout(autoStartTimer);
});
</script>
</body>
</html>
